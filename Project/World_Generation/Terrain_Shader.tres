[gd_resource type="VisualShader" load_steps=53 format=3 uid="uid://b7gjudd3nwgnl"]

[ext_resource type="Texture2D" uid="uid://bxnba2n264pgx" path="res://Test_Items/HeightMap_Normal.png" id="1_fs42v"]

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_yywty"]
parameter_name = "Albedo"
texture_type = 1
color_default = 2
texture_repeat = 1

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_54unx"]
input_name = "view_matrix"

[sub_resource type="VisualShaderNodeDotProduct" id="VisualShaderNodeDotProduct_erh6b"]
default_input_values = [0, Vector3(0, 0, 0), 1, Vector3(0, 1, 0)]

[sub_resource type="VisualShaderNodeTransformVecMult" id="VisualShaderNodeTransformVecMult_6nfqu"]
default_input_values = [0, Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0), 1, Vector3(0, 1, 0)]
operator = 2

[sub_resource type="VisualShaderNodeMix" id="VisualShaderNodeMix_ue5aw"]
default_input_values = [0, Vector3(0, 0, 0), 1, Vector3(1, 1, 1), 2, Vector3(0.5, 0.5, 0.5)]
op_type = 3

[sub_resource type="VisualShaderNodeTexture" id="VisualShaderNodeTexture_vwp15"]
source = 5

[sub_resource type="VisualShaderNodeSmoothStep" id="VisualShaderNodeSmoothStep_kwc0c"]

[sub_resource type="VisualShaderNodeFloatParameter" id="VisualShaderNodeFloatParameter_md8nt"]
parameter_name = "offset"
hint = 1
min = -1.0
max = 2.0

[sub_resource type="VisualShaderNodeFloatParameter" id="VisualShaderNodeFloatParameter_xqic7"]
parameter_name = "fade"
hint = 1
min = -1.0

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_u3724"]

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_a5jhl"]
operator = 1

[sub_resource type="VisualShaderNodeTexture" id="VisualShaderNodeTexture_esc7p"]
texture = ExtResource("1_fs42v")
texture_type = 2

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_s5vkd"]
default_input_values = [0, Vector3(0, 0, 0), 1, Vector3(2, 2, 2)]
operator = 2

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_mndi8"]
default_input_values = [0, Vector3(0, 0, 0), 1, Vector3(1, 1, 1)]
operator = 1

[sub_resource type="VisualShaderNodeVectorDecompose" id="VisualShaderNodeVectorDecompose_bphq8"]

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_fbhrw"]
operator = 2

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_akm1u"]
operator = 1

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_fiogr"]
default_input_values = [0, 1.0, 1, 0.0]

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_qv6um"]
default_input_values = [0, 1.0, 1, 0.0]

[sub_resource type="VisualShaderNodeFloatFunc" id="VisualShaderNodeFloatFunc_dhqoq"]
function = 11

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_avn4y"]
operator = 2

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_8y8xj"]
input_name = "tangent"

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_jiyxj"]
operator = 2

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_wg8s4"]
input_name = "binormal"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_mwdi7"]
input_name = "normal"

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_c54ki"]
operator = 2

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_010x2"]

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_srnw8"]

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_ebcou"]
size = Vector2(1880.82, 409.104)
expression = "vec2 e = vec2(0.01, 0.0);
vec3 normal = normalize(vec3(fbm(VERTEX.xz - e,uv_inp) * height_scale - fbm(VERTEX.xz + e,uv_inp) * height_scale, 1.0 * e.x, fbm(VERTEX.xz - e.yx,uv_inp) * height_scale - fbm(VERTEX.xz + e.yx,uv_inp) * height_scale));

n = normal;"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_0i0ib"]
input_name = "vertex"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_iapup"]
input_name = "uv"

[sub_resource type="VisualShaderNodeVaryingGetter" id="VisualShaderNodeVaryingGetter_o5g55"]
varying_name = "t_height"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_cddka"]
input_name = "color"

[sub_resource type="VisualShaderNodeVaryingGetter" id="VisualShaderNodeVaryingGetter_8jwqb"]
varying_name = "norm_y"

[sub_resource type="VisualShaderNodeColorConstant" id="VisualShaderNodeColorConstant_yxirl"]
constant = Color(0.384648, 0.271534, 0.112239, 1)

[sub_resource type="VisualShaderNodeVectorDecompose" id="VisualShaderNodeVectorDecompose_2bh0b"]

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_rg5dn"]

[sub_resource type="VisualShaderNodeVaryingSetter" id="VisualShaderNodeVaryingSetter_efne1"]
varying_name = "t_height"

[sub_resource type="VisualShaderNodeVaryingSetter" id="VisualShaderNodeVaryingSetter_yrsdv"]

[sub_resource type="VisualShaderNodeGlobalExpression" id="VisualShaderNodeGlobalExpression_0wqe4"]
size = Vector2(521.728, 160.744)
expression = "float fbm(vec2 x, vec2 _UV){
  float hgt = texture(heightmap,_UV).y * terrain_height;
  return hgt;
}"

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_8b1hn"]
size = Vector2(1072.98, 344.31)
expression = "vec2 e = vec2(0.01, 0.0);
vec3 normal = normalize(vec3(fbm(VERTEX.xz - e,uv_inp) - fbm(VERTEX.xz + e,uv_inp), 1.0 * e.x, fbm(VERTEX.xz - e.yx,uv_inp) * height_scale - fbm(VERTEX.xz + e.yx,uv_inp) * height_scale));
norm = normal"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_l0nfe"]
input_name = "uv"

[sub_resource type="VisualShaderNodeVaryingSetter" id="VisualShaderNodeVaryingSetter_2ug5a"]
varying_name = "norm_y"

[sub_resource type="VisualShaderNodeFloatParameter" id="VisualShaderNodeFloatParameter_dcbnr"]
parameter_name = "terrain_height"

[sub_resource type="VisualShaderNodeVectorDecompose" id="VisualShaderNodeVectorDecompose_a4akh"]

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_1muh0"]
parameter_name = "heightmap"
color_default = 2
texture_repeat = 1

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_cwvom"]
input_name = "uv"

[sub_resource type="VisualShaderNodeTexture" id="VisualShaderNodeTexture_lmr8e"]
source = 5

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_ebphs"]
operator = 2

[sub_resource type="VisualShaderNodeVectorCompose" id="VisualShaderNodeVectorCompose_4rk7k"]

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_lchwe"]
input_name = "vertex"

[resource]
code = "shader_type spatial;
render_mode blend_mix, depth_draw_opaque, cull_back, diffuse_toon, specular_toon;


// Varyings
varying float t_height;
varying float norm_y;

uniform sampler2D heightmap : hint_default_transparent, repeat_enable;
uniform float terrain_height;
uniform sampler2D tex_frg_35 : hint_normal;


// GlobalExpression:0
	float fbm(vec2 x, vec2 _UV){
	  float hgt = texture(heightmap,_UV).y * terrain_height;
	  return hgt;
	}

void vertex() {
// Input:9
	vec3 n_out9p0 = VERTEX;


// VectorDecompose:10
	float n_out10p0 = n_out9p0.x;
	float n_out10p1 = n_out9p0.y;
	float n_out10p2 = n_out9p0.z;


// Input:5
	vec2 n_out5p0 = UV;


	vec4 n_out6p0;
// Texture2D:6
	n_out6p0 = texture(heightmap, n_out5p0);


// FloatParameter:2
	float n_out2p0 = terrain_height;


// FloatOp:7
	float n_out7p0 = n_out6p0.x * n_out2p0;


// FloatOp:11
	float n_out11p0 = n_out7p0 + n_out10p1;


// VectorCompose:8
	vec3 n_out8p0 = vec3(n_out10p0, n_out11p0, n_out10p2);


// Input:17
	vec2 n_out17p0 = UV;


	vec3 n_out16p0;
// Expression:16
	n_out16p0 = vec3(0.0, 0.0, 0.0);
	{
		vec2 e = vec2(0.01, 0.0);
		vec3 normal = normalize(vec3(fbm(n_out8p0.xz - e,n_out17p0) - fbm(n_out8p0.xz + e,n_out17p0), 1.0 * e.x, fbm(n_out8p0.xz - e.yx,n_out17p0) * n_out2p0 - fbm(n_out8p0.xz + e.yx,n_out17p0) * n_out2p0));
		n_out16p0 = normal
	}


// Output:0
	VERTEX = n_out8p0;
	NORMAL = n_out16p0;
	COLOR.rgb = n_out16p0;


// VaryingSetter:13
	t_height = n_out2p0;


// VectorDecompose:20
	float n_out20p0 = n_out16p0.x;
	float n_out20p1 = n_out16p0.y;
	float n_out20p2 = n_out16p0.z;


// VaryingSetter:19
	norm_y = n_out20p1;


}

void fragment() {
// Input:56
	vec4 n_out56p0 = COLOR;


// Texture2D:35
	vec4 n_out35p0 = texture(tex_frg_35, UV);


// Output:0
	ALBEDO = vec3(n_out56p0.xyz);
	NORMAL_MAP = vec3(n_out35p0.xyz);


}
"
modes/diffuse = 3
modes/specular = 1
varyings/t_height = "0,0"
varyings/norm_y = "0,0"
nodes/vertex/0/position = Vector2(-330.974, 370.743)
nodes/vertex/2/node = SubResource("VisualShaderNodeFloatParameter_dcbnr")
nodes/vertex/2/position = Vector2(-1907.9, 429.523)
nodes/vertex/4/node = SubResource("VisualShaderNodeTexture2DParameter_1muh0")
nodes/vertex/4/position = Vector2(-2018.01, 153.153)
nodes/vertex/5/node = SubResource("VisualShaderNodeInput_cwvom")
nodes/vertex/5/position = Vector2(-1896.85, 86.7862)
nodes/vertex/6/node = SubResource("VisualShaderNodeTexture_lmr8e")
nodes/vertex/6/position = Vector2(-1546.44, 181.306)
nodes/vertex/7/node = SubResource("VisualShaderNodeFloatOp_ebphs")
nodes/vertex/7/position = Vector2(-1296.85, 366.786)
nodes/vertex/8/node = SubResource("VisualShaderNodeVectorCompose_4rk7k")
nodes/vertex/8/position = Vector2(-616.849, 446.786)
nodes/vertex/9/node = SubResource("VisualShaderNodeInput_lchwe")
nodes/vertex/9/position = Vector2(-1880, 680)
nodes/vertex/10/node = SubResource("VisualShaderNodeVectorDecompose_2bh0b")
nodes/vertex/10/position = Vector2(-1152.53, 604.415)
nodes/vertex/11/node = SubResource("VisualShaderNodeFloatOp_rg5dn")
nodes/vertex/11/position = Vector2(-960.879, 504.563)
nodes/vertex/13/node = SubResource("VisualShaderNodeVaryingSetter_efne1")
nodes/vertex/13/position = Vector2(-1560.58, 588.547)
nodes/vertex/14/node = SubResource("VisualShaderNodeVaryingSetter_yrsdv")
nodes/vertex/14/position = Vector2(-1079.78, 193.364)
nodes/vertex/15/node = SubResource("VisualShaderNodeGlobalExpression_0wqe4")
nodes/vertex/15/position = Vector2(-1698.79, 879.597)
nodes/vertex/15/size = Vector2(521.728, 160.744)
nodes/vertex/15/input_ports = ""
nodes/vertex/15/output_ports = ""
nodes/vertex/15/expression = "float fbm(vec2 x, vec2 _UV){
  float hgt = texture(heightmap,_UV).y * terrain_height;
  return hgt;
}"
nodes/vertex/16/node = SubResource("VisualShaderNodeExpression_8b1hn")
nodes/vertex/16/position = Vector2(-540, 880)
nodes/vertex/16/size = Vector2(1072.98, 344.31)
nodes/vertex/16/input_ports = "0,4,VERTEX;1,3,uv_inp;2,0,height_scale;"
nodes/vertex/16/output_ports = "0,4,norm;"
nodes/vertex/16/expression = "vec2 e = vec2(0.01, 0.0);
vec3 normal = normalize(vec3(fbm(VERTEX.xz - e,uv_inp) - fbm(VERTEX.xz + e,uv_inp), 1.0 * e.x, fbm(VERTEX.xz - e.yx,uv_inp) * height_scale - fbm(VERTEX.xz + e.yx,uv_inp) * height_scale));
norm = normal"
nodes/vertex/17/node = SubResource("VisualShaderNodeInput_l0nfe")
nodes/vertex/17/position = Vector2(-920, 960)
nodes/vertex/19/node = SubResource("VisualShaderNodeVaryingSetter_2ug5a")
nodes/vertex/19/position = Vector2(914.66, 1032.8)
nodes/vertex/20/node = SubResource("VisualShaderNodeVectorDecompose_a4akh")
nodes/vertex/20/position = Vector2(724.62, 1098.83)
nodes/vertex/connections = PackedInt32Array(4, 0, 6, 2, 2, 0, 7, 1, 6, 0, 7, 0, 7, 0, 11, 0, 10, 1, 11, 1, 5, 0, 6, 0, 8, 0, 0, 0, 11, 0, 8, 1, 6, 0, 14, 0, 2, 0, 13, 0, 10, 2, 8, 2, 10, 0, 8, 0, 9, 0, 10, 0, 16, 0, 20, 0, 20, 1, 19, 0, 16, 0, 0, 1, 17, 0, 16, 1, 16, 0, 0, 6, 8, 0, 16, 0, 2, 0, 16, 2)
nodes/fragment/0/position = Vector2(409.058, 575.831)
nodes/fragment/2/node = SubResource("VisualShaderNodeTexture2DParameter_yywty")
nodes/fragment/2/position = Vector2(-827.968, -298.291)
nodes/fragment/3/node = SubResource("VisualShaderNodeTexture_vwp15")
nodes/fragment/3/position = Vector2(-376.038, -192.671)
nodes/fragment/9/node = SubResource("VisualShaderNodeColorConstant_yxirl")
nodes/fragment/9/position = Vector2(-299.93, 564.571)
nodes/fragment/23/node = SubResource("VisualShaderNodeInput_54unx")
nodes/fragment/23/position = Vector2(-1355.54, 570.517)
nodes/fragment/25/node = SubResource("VisualShaderNodeDotProduct_erh6b")
nodes/fragment/25/position = Vector2(-508.302, 562.107)
nodes/fragment/26/node = SubResource("VisualShaderNodeTransformVecMult_6nfqu")
nodes/fragment/26/position = Vector2(-986.218, 586.166)
nodes/fragment/29/node = SubResource("VisualShaderNodeMix_ue5aw")
nodes/fragment/29/position = Vector2(119.647, 353.412)
nodes/fragment/30/node = SubResource("VisualShaderNodeSmoothStep_kwc0c")
nodes/fragment/30/position = Vector2(-305.519, 164.071)
nodes/fragment/31/node = SubResource("VisualShaderNodeFloatParameter_md8nt")
nodes/fragment/31/position = Vector2(-867.988, 13.9876)
nodes/fragment/32/node = SubResource("VisualShaderNodeFloatParameter_xqic7")
nodes/fragment/32/position = Vector2(-885.681, 238.318)
nodes/fragment/33/node = SubResource("VisualShaderNodeFloatOp_u3724")
nodes/fragment/33/position = Vector2(-523.986, 41.0299)
nodes/fragment/34/node = SubResource("VisualShaderNodeFloatOp_a5jhl")
nodes/fragment/34/position = Vector2(-508.916, 154.744)
nodes/fragment/35/node = SubResource("VisualShaderNodeTexture_esc7p")
nodes/fragment/35/position = Vector2(-2776.46, 527.283)
nodes/fragment/36/node = SubResource("VisualShaderNodeVectorOp_s5vkd")
nodes/fragment/36/position = Vector2(-2372.34, 399.057)
nodes/fragment/37/node = SubResource("VisualShaderNodeVectorOp_mndi8")
nodes/fragment/37/position = Vector2(-2227.11, 399.057)
nodes/fragment/38/node = SubResource("VisualShaderNodeVectorDecompose_bphq8")
nodes/fragment/38/position = Vector2(-2106.47, 382.124)
nodes/fragment/39/node = SubResource("VisualShaderNodeFloatOp_fbhrw")
nodes/fragment/39/position = Vector2(-2068.11, 512.279)
nodes/fragment/40/node = SubResource("VisualShaderNodeFloatOp_akm1u")
nodes/fragment/40/position = Vector2(-2066.74, 620.514)
nodes/fragment/41/node = SubResource("VisualShaderNodeFloatOp_fiogr")
nodes/fragment/41/position = Vector2(-2062.63, 726.008)
nodes/fragment/42/node = SubResource("VisualShaderNodeFloatOp_qv6um")
nodes/fragment/42/position = Vector2(-2069.68, 822.172)
nodes/fragment/43/node = SubResource("VisualShaderNodeFloatFunc_dhqoq")
nodes/fragment/43/position = Vector2(-1852.53, 739.814)
nodes/fragment/44/node = SubResource("VisualShaderNodeVectorOp_avn4y")
nodes/fragment/44/position = Vector2(-1777.16, 129.038)
nodes/fragment/45/node = SubResource("VisualShaderNodeInput_8y8xj")
nodes/fragment/45/position = Vector2(-1914.17, 72.866)
nodes/fragment/46/node = SubResource("VisualShaderNodeVectorOp_jiyxj")
nodes/fragment/46/position = Vector2(-1808.68, 329.066)
nodes/fragment/47/node = SubResource("VisualShaderNodeInput_wg8s4")
nodes/fragment/47/position = Vector2(-1919.65, 263.303)
nodes/fragment/48/node = SubResource("VisualShaderNodeInput_mwdi7")
nodes/fragment/48/position = Vector2(-1879.92, 467.442)
nodes/fragment/49/node = SubResource("VisualShaderNodeVectorOp_c54ki")
nodes/fragment/49/position = Vector2(-1804.57, 512.653)
nodes/fragment/50/node = SubResource("VisualShaderNodeVectorOp_010x2")
nodes/fragment/50/position = Vector2(-1547.06, 222.276)
nodes/fragment/51/node = SubResource("VisualShaderNodeVectorOp_srnw8")
nodes/fragment/51/position = Vector2(-1438.76, 377.915)
nodes/fragment/52/node = SubResource("VisualShaderNodeExpression_ebcou")
nodes/fragment/52/position = Vector2(-2157.31, 973.416)
nodes/fragment/52/size = Vector2(1880.82, 409.104)
nodes/fragment/52/input_ports = "0,4,VERTEX;1,3,uv_inp;2,0,height_scale;"
nodes/fragment/52/output_ports = "0,4,n;"
nodes/fragment/52/expression = "vec2 e = vec2(0.01, 0.0);
vec3 normal = normalize(vec3(fbm(VERTEX.xz - e,uv_inp) * height_scale - fbm(VERTEX.xz + e,uv_inp) * height_scale, 1.0 * e.x, fbm(VERTEX.xz - e.yx,uv_inp) * height_scale - fbm(VERTEX.xz + e.yx,uv_inp) * height_scale));

n = normal;"
nodes/fragment/53/node = SubResource("VisualShaderNodeInput_0i0ib")
nodes/fragment/53/position = Vector2(-2705.12, 1020.15)
nodes/fragment/54/node = SubResource("VisualShaderNodeInput_iapup")
nodes/fragment/54/position = Vector2(-2720, 1120)
nodes/fragment/55/node = SubResource("VisualShaderNodeVaryingGetter_o5g55")
nodes/fragment/55/position = Vector2(-2700, 1300)
nodes/fragment/56/node = SubResource("VisualShaderNodeInput_cddka")
nodes/fragment/56/position = Vector2(-100, 660)
nodes/fragment/57/node = SubResource("VisualShaderNodeVaryingGetter_8jwqb")
nodes/fragment/57/position = Vector2(-580, 360)
nodes/fragment/connections = PackedInt32Array(2, 0, 3, 2, 31, 0, 33, 0, 32, 0, 33, 1, 33, 0, 30, 1, 31, 0, 34, 0, 32, 0, 34, 1, 34, 0, 30, 0, 23, 0, 26, 0, 36, 0, 37, 0, 37, 0, 38, 0, 38, 0, 39, 0, 38, 0, 39, 1, 38, 1, 40, 0, 38, 1, 40, 1, 38, 0, 44, 0, 38, 1, 46, 0, 39, 0, 41, 1, 40, 0, 42, 1, 41, 0, 42, 0, 42, 0, 43, 0, 43, 0, 49, 0, 45, 0, 44, 1, 44, 0, 50, 0, 47, 0, 46, 1, 46, 0, 50, 1, 48, 0, 49, 1, 49, 0, 51, 1, 50, 0, 51, 0, 35, 0, 0, 9, 35, 0, 36, 0, 9, 0, 29, 0, 3, 0, 29, 1, 53, 0, 52, 0, 26, 0, 25, 0, 30, 0, 29, 2, 54, 0, 52, 1, 55, 0, 52, 2, 52, 0, 25, 1, 25, 0, 30, 2, 56, 0, 0, 0)
